const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t,this.state=t.map(t=>[...t]),this.score=0,this.status="idle"}moveLeft(){if("playing"!==this.status)return;let t=!1,e=JSON.stringify(this.state);for(let t=0;t<this.state.length;t++){let e=this.state[t];e=this.slide(e),this.state[t]=e}e!==JSON.stringify(this.state)&&(t=!0),t&&(this.addRandomTile(),this.checkWin(),this.checkLose())}moveRight(){if("playing"!==this.status)return;let t=!1,e=JSON.stringify(this.state);for(let t=0;t<this.state.length;t++){let e=this.state[t];e.reverse(),e=this.slide(e),this.state[t]=e.reverse()}e!==JSON.stringify(this.state)&&(t=!0),t&&(this.addRandomTile(),this.checkWin(),this.checkLose())}moveUp(){if("playing"!==this.status)return;let t=!1,e=JSON.stringify(this.state);for(let t=0;t<this.state.length;t++){let e=[this.state[0][t],this.state[1][t],this.state[2][t],this.state[3][t]];e=this.slide(e),this.state[0][t]=e[0],this.state[1][t]=e[1],this.state[2][t]=e[2],this.state[3][t]=e[3]}e!==JSON.stringify(this.state)&&(t=!0),t&&(this.addRandomTile(),this.checkWin(),this.checkLose())}moveDown(){if("playing"!==this.status)return;let t=!1,e=JSON.stringify(this.state);for(let t=0;t<this.state.length;t++){let e=[this.state[0][t],this.state[1][t],this.state[2][t],this.state[3][t]];e.reverse(),(e=this.slide(e)).reverse(),this.state[0][t]=e[0],this.state[1][t]=e[1],this.state[2][t]=e[2],this.state[3][t]=e[3]}e!==JSON.stringify(this.state)&&(t=!0),t&&(this.addRandomTile(),this.checkWin(),this.checkLose())}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.addRandomTile(),this.addRandomTile(),this.status="playing"}restart(){this.state=this.initialState.map(t=>[...t]),this.score=0,this.status="idle"}addRandomTile(){let t=this.getEmptyCells();if(0===t.length)return;let e=Math.floor(Math.random()*t.length),[s,i]=t[e];this.state[s][i]=Math.random()>.9?4:2}getEmptyCells(){let t=[];return this.state.forEach((e,s)=>{for(let i=0;i<e.length;i++)0===e[i]&&t.push([s,i])}),t}filterZero(t){return t.filter(t=>0!==t)}slide(t){let e=this.filterZero(t);for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,e[t+1]=0,this.score+=e[t]);for(e=this.filterZero(e);e.length<this.state.length;)e.push(0);return e}checkWin(){for(let t of this.state)if(t.includes(2048))return this.status="win",!0;return!1}checkLose(){if(!(this.getEmptyCells().length>0)){for(let t=0;t<this.state.length;t++)for(let e=0;e<this.state[t].length-1;e++)if(this.state[t][e]===this.state[t][e+1]||t<this.state.length-1&&this.state[t][e]===this.state[t+1][e])return;this.status="lose"}}},e=document.querySelector(".start"),s=document.querySelector(".game-score"),i=document.querySelector(".message-start"),a=document.querySelector(".message-win"),h=document.querySelector(".message-lose");function r(){let e=t.getState(),i=document.querySelectorAll(".field-row");s.textContent="",s.textContent=t.getScore(),i.forEach((t,s)=>{t.querySelectorAll(".field-cell").forEach((t,i)=>{let a=e[s][i];t.textContent=0===a?"":a,t.className="field-cell",0!==a&&t.classList.add(`field-cell--${a}`)})})}e.addEventListener("click",s=>{e.classList.contains("start")?(t.start(),r(),i.classList.add("hidden"),e.classList.remove("start"),e.textContent="Restart",e.classList.add("restart")):(t.restart(),r(),i.classList.remove("hidden"),e.classList.remove("restart"),e.textContent="Start",e.classList.add("start"))}),document.addEventListener("keydown",e=>{switch(e.code){case"KeyA":case"ArrowLeft":t.moveLeft();break;case"KeyW":case"ArrowUp":t.moveUp();break;case"KeyD":case"ArrowRight":t.moveRight();break;case"KeyS":case"ArrowDown":t.moveDown()}r(),"lose"===t.getStatus()?(h.classList.remove("hidden"),a.classList.add("hidden"),i.classList.add("hidden")):"win"===t.getStatus()&&(a.classList.remove("hidden"),h.classList.add("hidden"),i.classList.add("hidden"))});
//# sourceMappingURL=index.953e0ed4.js.map
